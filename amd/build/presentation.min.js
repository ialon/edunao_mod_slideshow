/**
 * Add navigation functionality to slideshow
 *
 * @module      mod_slideshow/presentation
 * @copyright   2025 Josemaria Bolanos <admin@mako.digital>
 * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define(["qrcode"],(function(e){const t=".slide",s=".prev",i=".next",d=".currentslide",l=".fontsize",n=".overlay",c=".qrcode",r=".fullscreen",o=".editslide";return{init:function(u){let a=document.querySelector("#slideshow-"+u.cmid),h=a.querySelectorAll(t),f=h.length,L=0,v=a.querySelector(s),m=a.querySelector(i),y=a.querySelector(d),E=a.querySelector(n),g=a.querySelector(l),q=a.querySelector(r),w=document.querySelector(o);if(E.setAttribute("style","width: "+a.offsetWidth+"px; height: "+a.offsetWidth*(9/16)+"px;"),E.addEventListener("click",(()=>{E.classList.toggle("hidden")})),u.enrolurl){a.querySelector(c).addEventListener("click",(()=>{E.classList.toggle("hidden")})),new e(E,{text:u.enrolurl,width:.5*a.offsetHeight,height:.5*a.offsetHeight})}document.addEventListener("keyup",(e=>{document.fullscreenElement&&("ArrowLeft"===e.key&&p(),"ArrowRight"===e.key&&b())})),document.addEventListener("fullscreenchange",(()=>{document.fullscreenElement?(a.classList.add("fullscreen"),g.value="300"):(a.classList.remove("fullscreen"),g.value="150"),g.dispatchEvent(new Event("input",{bubbles:!0})),x()})),v.addEventListener("click",(()=>{p()}));const p=()=>{L>0&&(h[L].classList.add("hidden"),h[L-1].classList.remove("hidden"),L--,k())};m.addEventListener("click",(()=>{b()}));const b=()=>{L<f-1&&(h[L].classList.add("hidden"),h[L+1].classList.remove("hidden"),L++,k())};q.addEventListener("click",(()=>{document.fullscreenElement?document.exitFullscreen():a.requestFullscreen()})),g.addEventListener("input",(function(){a.style.fontSize=this.value+"%"})),w.addEventListener("click",(()=>{S()}));const S=()=>{let e=h[L].getAttribute("data-slideid");window.location.href="/mod/slideshow/edit.php?cm="+u.cmid+"&id="+e},k=()=>{y.innerText=L+1+"/"+f,0===L?v.classList.add("disabled"):v.classList.remove("disabled"),L===f-1?m.classList.add("disabled"):m.classList.remove("disabled")};window.addEventListener("resize",(()=>{x()}),!0);const x=()=>{E.setAttribute("style","width: "+a.offsetWidth+"px; height: "+a.offsetWidth*(9/16)+"px;"),h.forEach((e=>{e.setAttribute("style","height: "+a.offsetWidth*(9/16)+"px;")}))};x()}}}));